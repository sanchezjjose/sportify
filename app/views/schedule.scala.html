@(gameForm: Form[GameForm], season: String, nextGame: Option[Game], games: List[Game])(user: User)(implicit flash: Flash)

@import helper._
@import controllers._

@main(Html(season + " Schedule."), nav = "schedule") {

    <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/schedule.css")">

    <div class="main">
      <div class="season regular">

        <div class="message">
          @if(flash.get("failure").isDefined) {
              <div class="alert alert-danger">
                  <button type="button" class="close" data-dismiss="alert">Ã—</button>
                  @flash.get("failure")
              </div>
          }
        </div>

        @if(user.isAdmin) {
          @(newGameForm())
          @(editGameForm())
        }

        <h2 class="header">Regular Season</h2> 

        @if(user.isAdmin) {
          <a href="#" class="add">+ Add game</a>
        }

  	    <table class="table table-striped table-hover">
  		    <tbody>
  		    	<thead>
  			        <tr>
  			          <td>Details</td>
  			          <td>Status</td>
  			        </tr>
  		    	</thead>
		        @for(game <- games.filter(g => g.is_playoff_game == false)) {
              @if(nextGame.isDefined && nextGame.get.game_id == game.game_id) {
                <tr id="@game.game_id" class="success">
              } else{
                <tr id="@game.game_id">
              }
                  <td class="game-details">
                    <div>
                      <b>Game @game.game_seq</b> <br>
                      @game.startTime <br>
                      @game.address <br>
                      vs. @game.opponent <br>
                      <b>
                          @if(game.result.contains("W")){
                            <font color="green">@game.result</font>
                          }else{
                            <font color="red">@game.result</font>
                          }
                      </b>

                      @if(user.isAdmin) {
                        <div>
                          <br>
                          <a href="@routes.Schedule.edit(game.game_id)" class="edit text-muted">Edit</a> &nbsp;
                          <a href="#" onclick='deleteGame(@game.game_id)' class="delete text-danger">Delete</a>
                        </div>
                      }

                    </div>
                  </td>
                  <td>
                      <div class="schedule form">
                          <a href="/schedule/submit?status=in?game_id=@game.game_id" class="btn btn-primary">In</a>
                          <a href="/schedule/submit?status=out?game_id=@game.game_id" class="btn btn-default">Out</a>
                      </div>
                  </td>
                </tr>
		        }
  			   </tbody>
  	    </table>
      </div>

      <div class="season playoffs">
        <h2 class="header">Playoffs</h2>

        @if(user.isAdmin) {
          <a href="#" class="add">+ Add game</a>
        }

        <table class="table table-striped table-hover">
            <tbody>
            <thead>
            <tr>
                <td>Details</td>
                <td>Status</td>
            </tr>
            </thead>

            @for(game <- games.filter(g => g.is_playoff_game == true)) {
              <tr id="@game.game_id">
                  <td class="game-details">
                      <b>Game @game.game_seq</b> <br>
                      @game.startTime <br>
                      @game.address <br>
                      vs. @game.opponent <br>
                      <b>
                          @if(game.result.contains("W")) {
                            <font color="green">@game.result</font>
                          }else {
                            <font color="red">@game.result</font>
                          }
                      </b>

                      @if(user.isAdmin) {
                        <div>
                          <br>
                          <a href="@routes.Schedule.edit(game.game_id)" class="edit text-muted">Edit</a> &nbsp;
                          <a href="#" onclick='deleteGame(@game.game_id)' class="delete text-danger">Delete</a>
                        </div>
                      }

                  </td>
                  <td class="game-rsvp">
                      <div class="schedule form">
                          <a href="/schedule/submit?status=in?game_id=@game.game_id" class="btn btn-danger">In</a>
                          <a href="/schedule/submit?status=out?game_id=@game.game_id" class="btn btn-default">Out</a>
                      </div>
                  </td>
              </tr>
            }
            </tbody>
        </table>
      </div>
    </div>

    <script type="text/javascript">
   	  $(document).ready(function () {
   	  	function init () {

          // rsvp for a particular game
   	  		$('.schedule > .btn').click(function (ev) {
   	  			ev.preventDefault();
   	  			$.ajax({
   	  				url: $(this).attr('href'),
   	  				success: function (data) {

   	  					$('.alert').remove();
   	  					if (data.status === 'in') {
							     $('.season:first-child').before('<div class="game-status-msg alert alert-info">'+data.msg+'</div>');
   	  					} else {
							     $('.season:first-child').before('<div class="game-status-msg alert alert-danger" >'+data.msg+'</div>');
   	  					}
   	  					window.scrollTo(0, 0);
   	  					setTimeout(function clearMsg () {
   	  						$('.alert').fadeOut('1000', function (el) {
   	  							$(el).remove();
   	  						});
   	  					}, 5000);
   	  				}
   	  			});
   	  		});

          // open add new game modal
          $('.regular .add').click(function (ev) {
            ev.preventDefault();

            // clear inputs
            $('form input').val("")

            $('#new-game form').get(0).setAttribute('action', '/schedule/save/' + false);
            $('#new-game form').get(0).setAttribute('method', 'post');

            // open modal
            window.location = "#new-game";
          });

          // open add new game modal
          $('.playoffs .add').click(function (ev) {
            ev.preventDefault();

            // clear inputs
            $('form input').val("")

            $('#new-game form').get(0).setAttribute('action', '/schedule/save/' + true);
            $('#new-game form').get(0).setAttribute('method', 'post');

            // open modal
            window.location = "#new-game";
          });

          // open and set fields for the edit game modal
          $('.regular .edit').click(function (ev) {
            ev.preventDefault();
            $.ajax({
              url: $(this).attr('href'),
              success: function (data) {
                $(".start_time input").val(data.start_time);
                $(".address input").val(data.address);
                $(".gym input").val(data.gym);
                $(".location_details input").val(data.location_details);
                $(".opponent input").val(data.opponent);
                $(".result input").val(data.result);

                $('#edit-game form').get(0).setAttribute('action', '/schedule/update/' + data.game_id + '/' + data.game_seq + '/' + false);
                $('#edit-game form').get(0).setAttribute('method', 'post');

                // open and fill form
                window.location = "#edit-game";
              }
            });
          });

          // open and set fields for the edit game modal
          $('.playoffs .edit').click(function (ev) {
            ev.preventDefault();
            $.ajax({
              url: $(this).attr('href'),
              success: function (data) {
                $(".start_time input").val(data.start_time);
                $(".address input").val(data.address);
                $(".gym input").val(data.gym);
                $(".location_details input").val(data.location_details);
                $(".opponent input").val(data.opponent);
                $(".result input").val(data.result);

                $('#edit-game form').get(0).setAttribute('action', '/schedule/update/' + data.game_id + '/' + data.game_seq + '/' + true);
                $('#edit-game form').get(0).setAttribute('method', 'post');

                // open and fill form
                window.location = "#edit-game";
              }
            });
          });
   	  	}

   	  	init();
   	  });
  
      function deleteGame(gameId) {
            var shouldDelete = confirm('Are you sure you want to delete this game?');
            if (shouldDelete) {
              window.location = "/schedule/delete/" + gameId;
            }
          };

   	</script>
}

